# Отчет по лабораторной работе №2
# Организация данных и системный каталог

**Дата:** 2025-11-27
**Семестр:** 4 курс 1 полугодие – 7 семестр  
**Группа:** ПИЖ-б-о-22-1  
**Дисциплина:** Администрирование баз данных  
**Студент:** Джараян Арег Александрович

## Цель работы
Всестороннее изучение логической и физической структуры хранения данных в
PostgreSQL. Получение практических навыков управления базами данных, схемами, табличными
пространствами. Глубокое освоение работы с системным каталогом для извлечения метаинформации.
Исследование низкоуровневых аспектов хранения, включая TOAST.

## Теоретическая часть
**Логическая структура: Иерархия: Кластер БД -> Базы данных -> Схемы -> Объекты (таблицы,
представления и т.д.).
**Физическая структура: Табличные пространства связывают логические объекты с физическим
расположением файлов на диске. Данные хранятся в файлах.
**Системный каталог: Набор системных таблиц (pg_class, pg_database, pg_namespace) и
представлений (pg_tables, pg_views), содержащих метаданные.
**Низкоуровневое хранение: Механизм TOAST для больших данных, нежурналируемые таблицы,
стратегии хранения столбцов.

## Практическая часть

### Часть 1.Базы данных и схемы

**Выполненные задачи:**
1. Создание и проверка БД: Создал новую базу данных lab02_db. Проверил ее начальный
размер с помощью pg_database_size('lab02_db').
```sql
sudo -u postgres createdb lab02_db
sudo -u postgres psql -At -c "SELECT pg_database_size ('lab02_db');"
```
```text
7602703
```
2. Работа со схемами: Подключился к lab02_db. Создалдве схемы: app и схему с именем
моего пользователя ОС (напр., student). В каждой схеме создайл по одной таблице и вставьте в
них данные.
```sql
sudo -u postgres psql -d lab02_db
```
```text
psql (16.9 (Ubuntu 16.9-1.pgdg24.04+1))
Type "help" for help.
```
```sql
CREATE SCHEMA app;
CREATE SCHEMA student; 
```
```text
CREATE SCHEMA
CREATE SCHEMA
```
```sql
CREATE TABLE app.users (
    id serial PRIMARY KEY,
    name text
);
INSERT INTO app.users (name) VALUES ('Areg');

CREATE TABLE student.items (
    id serial PRIMARY KEY,
    value text
);
INSERT INTO student.items (value) VALUES ('Test item');
```
```text
CREATE TABLE
INSERT 0 1
```
3. Контроль размера: Снова проверил размер базы данных. Объяснил его изменение.
   ```sql
   SELECT pg_size_pretty(pg_database_size('lab02_db'));
```
```text
 pg_size_pretty 
----------------
 7724 kB
(1 row)
```
--Даже пустая таблица занимает место на диске: PostgreSQL создаёт файлы для данных, для системных метаданных и для будущих страниц хранения. После вставки строк размер дополнительно увеличивается за счёт самих данных и служебных структур. То есть рост размера базы — результат появления новых объектов (схемы, таблицы, строки) и системных структур, которые PostgreSQL создаёт автоматически.

4. Управление путем поиска: Настройте параметр search_path для текущего сеанса так, чтобы
при обращении по неполному имени приоритет имела ваша пользовательская схема, а затем
схема app. Продемонстрируйте работу, обратившись к таблицам без указания схемы.
-- Настройка search_path в текущем сеансе
  ```sql
SET search_path = student, app, public;
SHOW search_path;
```
```text
     search_path      
----------------------
 student, app, public
(1 row)
```
-- Демонстрация работы
```sql
SELECT * FROM items;   
SELECT * FROM users;
```
```text
 id |   value   
----+-----------
  1 | Test item
(1 row)

ab02_db=# SELECT * FROM users;
 id | name 
----+------
  1 | Areg
(1 row)
```

5. Практика+ (Настройка параметра БД): Для базы lab02_db установите значение параметра
temp_buffers так, чтобы в каждом новом сеансе, подключенном к этой БД, оно было в 4 раза
больше значения по умолчанию. Проверьте работу.
-- Узнал значение по умолчанию для temp_buffers
   ```sql
   sudo -u postgres psql -d lab02_db
   SHOW temp_buffers;
   ```
   ```text
   lab02_db=# SHOW temp_buffers;
     temp_buffers 
    --------------
     8MB
    (1 row)
   ```
   -- Установил параметр для базы так, чтобы он был в 4 раза больше и проверил работу
   ```sql
   ALTER DATABASE lab02_db SET temp_buffers = '32MB';
   \c lab02_db
    SHOW temp_buffers;
    ```
   ```text
   lab02_db=# SHOW temp_buffers;
     temp_buffers 
    --------------
     32MB
    (1 row)
    ```
## Модуль 2: Системный каталог
**1. Исследование pg_class: Получил описание системной таблицы pg_class (команда \d
pg_class).

**2. Исследование pg_tables: Получил подробное описание представления pg_tables (команда
\d+ pg_tables). Объяснил разницу между таблицей и представлением.

**3. Временная таблица и список схем: В базе lab02_db создайте временную таблицу. Получил
полный список всех схем в этой БД, включая системные (pg_catalog, information_schema).
Объяснил наличие временной схемы.

**4. Представления information_schema: Получил список всех представлений в схеме
information_schema.

**5. Анализ метакоманды: Выполнил в psql команду \d+ pg_views. Изучил вывод и объясните,
какие запросы к системному каталогу скрыты за этой командой.

   
   

